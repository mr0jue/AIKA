#æ—¶åºå·®åˆ†å­¦ä¹  ï¼ˆTemporal-Difference Learningï¼‰æ–¹æ³•æ˜¯ #è’™ç‰¹å¡ç½—æ–¹æ³• çš„ä¸€ç§æ”¹è¿›ï¼Œé€šè¿‡å¼•å…¥ #åŠ¨æ€è§„åˆ’ç®—æ³• æ¥æé«˜å­¦ä¹ æ•ˆç‡ [Sutton et al.,2018]ï¼

#æ—¶åºå·®åˆ†å­¦ä¹ æ–¹æ³• æ˜¯æ¨¡æ‹Ÿä¸€æ®µè½¨è¿¹ï¼Œæ¯è¡ŒåŠ¨ä¸€æ­¥ (æˆ–è€…å‡ æ­¥)ï¼Œå°±åˆ©ç”¨ #è´å°”æ›¼æ–¹ç¨‹ æ¥è¯„ä¼°è¡ŒåŠ¨å‰çŠ¶æ€çš„ä»·å€¼ï¼å½“æ—¶åºå·®åˆ†å­¦ä¹ æ–¹æ³•ä¸­æ¯æ¬¡æ›´æ–°çš„åŠ¨ä½œæ•°ä¸ºæœ€å¤§æ­¥æ•°æ—¶ï¼Œå°±ç­‰ä»·äºè’™ç‰¹å¡ç½—æ–¹æ³•ï¼

é¦–å…ˆ, å°†è’™ç‰¹å¡ç½—æ–¹æ³•ä¸­ ${\mathrm{Q}}$ å‡½æ•° ${\hat{Q}^{\pi}(s, a)}$ çš„ä¼°è®¡æ”¹ä¸ºå¢é‡è®¡ç®—çš„æ–¹å¼, å‡è®¾ç¬¬ ${N}$ æ¬¡è¯•éªŒåå€¼å‡½æ•° ${\hat{Q}_{N}^{\pi}(s, a)}$ çš„å¹³å‡ä¸º$${\begin{align} 
\hat{Q}_{N}^{\pi}(s, a) 
&=\frac{1}{N} \sum_{n=1}^{N} G\left(\tau_{s_{0}=s, a_{0}=a}^{(n)}\right) \\
&=\frac{1}{N}\left(G\left(\tau_{s_{0}=s, a_{0}=a}^{(N)}+\sum_{n=1}^{N-1} G\left(\tau_{s_{0}=s, a_{0}=a}^{(n)}\right)\right)\right.\\
&=\frac{1}{N}\left(G\left(\tau_{s_{0}=s, a_{0}=a}^{(N)}+(N-1) \hat{Q}_{N-1}^{\pi}(s, a)\right)\right.\\ 
&=\hat{Q}_{N-1}^{\pi}(s, a)+\frac{1}{N}\left(G\left(\tau_{s_{0}=s, a_{0}=a}^{(N)}-\hat{Q}_{N-1}^{\pi}(s, a)\right),\right. 
\end{align}}$$ å…¶ä¸­ ${\tau_{s_{0}=s, a_{0}=a}}$ è¡¨ç¤ºè½¨è¿¹ ${\tau}$ çš„èµ·å§‹çŠ¶æ€å’ŒåŠ¨ä½œä¸º ${s, a}$. å€¼å‡½æ•° ${\hat{Q}^{\pi}(s, a)}$ åœ¨ç¬¬ ${N}$ è¯•éªŒåçš„å¹³å‡ç­‰äºç¬¬ ${N-1}$ è¯•éªŒåçš„å¹³å‡åŠ ä¸Šä¸€ä¸ªå¢é‡. æ›´ä¸€èˆ¬æ€§åœ°, æˆ‘ä»¬å°†æƒé‡ç³»æ•° ${\frac{1}{N}}$ æ”¹ä¸ºä¸€ä¸ªæ¯”è¾ƒå°çš„æ­£æ•° ${\alpha}$. è¿™æ ·æ¯æ¬¡é‡‡ç”¨ä¸€ä¸ªæ–°çš„è½¨è¿¹ ${\tau_{s_{0}=s, a_{0}=a}}$, å°±å¯ä»¥æ›´æ–° ${\hat{Q}^{\pi}(s, a)}$. $${ \hat{Q}^{\pi}(s, a) \leftarrow \hat{Q}^{\pi}(s, a)+\alpha\left(G\left(\tau_{s_{0}=s, a_{0}=a}\right)-\hat{Q}^{\pi}(s, a)\right), }$$å…¶ä¸­, ${G\left(\tau_{s_{0}=s, a_{0}=a}\right)}$ ä¸ºä¸€æ¬¡è¯•éªŒçš„å®Œæ•´è½¨è¿¹æ‰€å¾—åˆ°çš„æ€»å›æŠ¥. å…¶ä¸­å¢é‡$$\delta \triangleq G\left(\tau_{s_{0}=s, a_{0}=a}\right)-\hat{Q}^{\pi}(s, a)$$ ç§°ä¸º #è’™ç‰¹å¡ç½—è¯¯å·®, è¡¨ç¤ºå½“å‰è½¨è¿¹çš„ #çœŸå®å›æŠ¥ ${G\left(\tau_{s_{0}=s, a_{0}=a}\right)}$ ä¸ #æœŸæœ›å›æŠ¥ ${\hat{Q}^{\pi}(s, a)}$ ä¹‹é—´çš„å·®è·. 

## SARSA

ä¸ºäº†æé«˜æ•ˆç‡, å¯ä»¥å€ŸåŠ© #åŠ¨æ€è§„åˆ’ çš„æ–¹æ³•æ¥è®¡ç®— ${G\left(\tau_{s_{0}=s, a_{0}=a}\right)}$, è€Œä¸éœ€è¦å¾—åˆ°å®Œæ•´çš„è½¨è¿¹. ä» ${s, a}$ å¼€å§‹, é‡‡æ ·ä¸‹ä¸€æ­¥çš„çŠ¶æ€å’ŒåŠ¨ä½œ ${\left(s{\prime}, a{\prime}\right)}$, å¹¶å¾—åˆ°å¥–åŠ± ${r\left(s, a, s{\prime}\right)}$, ç„¶ååˆ©ç”¨ #è´å°”æ›¼æ–¹ç¨‹ æ¥è¿‘ä¼¼ä¼°è®¡ ${G\left(\tau_{s_{0}=s, a_{0}=a}\right)}$, $${ G\left(\tau_{s_{0}=s, a_{0}=a, s_{1}=s{\prime}, a_{1}=a{\prime}}\right) =r\left(s, a, s{\prime}\right)+\gamma G\left(\tau_{s_{0}=s{\prime}, a_{0}=a{\prime}}\right) \\ \approx r\left(s, a, s{\prime}\right)+\gamma \hat{Q}^{\pi}\left(s{\prime}, a{\prime}\right), }$$ å…¶ä¸­ ${\hat{Q}^{\pi}\left(s{\prime}, a{\prime}\right)}$ æ˜¯å½“å‰çš„ ${\mathrm{Q}}$ å‡½æ•°çš„è¿‘ä¼¼ä¼°è®¡. ç»“åˆä¸Šè¿°å…¬å¼, æœ‰ $${ \hat{Q}^{\pi}(s, a) \leftarrow \hat{Q}^{\pi}(s, a)+\alpha\left(r\left(s, a, s{\prime}\right)+\gamma \hat{Q}^{\pi}\left(s{\prime}, a{\prime}\right)-\hat{Q}^{\pi}(s, a)\right), }$$ å› æ­¤, æ›´æ–° ${\hat{Q}^{\pi}(s, a)}$ åªéœ€è¦çŸ¥é“å½“å‰çŠ¶æ€ ${s}$ å’ŒåŠ¨ä½œ ${a}$ ã€å¥–åŠ± ${r\left(s, a, s{\prime}\right)}$ ã€ä¸‹ä¸€æ­¥çš„çŠ¶ æ€ ${s{\prime}}$ å’ŒåŠ¨ä½œ ${a{\prime}}$. 

è¿™ç§ç­–ç•¥å­¦ä¹ æ–¹æ³•ç§°ä¸º #SARSA ç®—æ³• ( State Action Reward State Action, SARSA ) [Rummery et al., 1994]. 
$$\begin{array}{ll} 
\hline 
& \text{SARSA}\\
\hline 
& \text{è¾“å…¥: çŠ¶æ€ç©ºé—´ } \mathcal{S}, \text{ åŠ¨ä½œç©ºé—´ } \mathcal{A}, \text{ æŠ˜æ‰£ç‡ }  {\gamma}, \text{ å­¦ä¹ ç‡ } \alpha \\
1& \quad \forall s, \forall a, \text{ éšæœºåˆå§‹åŒ– } Q(s, a); \text{ æ ¹æ®Qå‡½æ•°æ„å»ºç­–ç•¥ } {\pi}; \\
2& \quad \text{repeat }\\
3& \quad \quad \text{åˆå§‹åŒ–èµ·å§‹çŠ¶æ€ } s; \text{ é€‰æ‹©åŠ¨ä½œ } a=\pi^{\epsilon}(s) ;\\
4& \quad \quad \text{repeat }\\
5& \quad \quad \quad \text{åœ¨çŠ¶æ€ } s{\prime}, \text{ é€‰æ‹©åŠ¨ä½œ } a{\prime}=\pi^{\epsilon}\left(s{\prime}\right) ;\\
6& \quad \quad \quad \text{æ‰§è¡ŒåŠ¨ä½œ } a,\text{ å¾—åˆ°å³æ—¶å¥–åŠ± } r \text{ å’Œæ–°çŠ¶æ€ } s{\prime};\\
7& \quad \quad \quad  Q(s, a) \leftarrow Q(s, a)+\alpha\left(r+\gamma Q\left(s{\prime}, a{\prime}\right)-Q(s, a)\right) ;  \\
8& \quad \quad \quad \pi(s)=\arg \max _{a \in|\mathcal{A}|} Q(s, a) \\
8& \quad \quad \quad s \leftarrow s{\prime} ;\\
9& \quad \quad \text{until } s \text{ ä¸ºç»ˆæ­¢çŠ¶æ€ } ;\\
10& \quad \text{until } \forall s, a, Q(s, a) \text{ æ”¶æ•› } ;\\
& \text{è¾“å‡º: ç­–ç•¥ } \pi(s) \\
\hline 
\end{array}
$$
$\pi^{\epsilon}(s)$ å‚è§ #ğœ–-è´ªå¿ƒæ³•ç­–ç•¥ å…¬å¼.

SARSAç®—æ³•çš„é‡‡æ ·å’Œä¼˜åŒ–çš„ç­–ç•¥éƒ½æ˜¯ ${\pi^{\epsilon}}$, å›  æ­¤æ˜¯ä¸€ç§ #åŒç­–ç•¥ ç®—æ³•. ä¸ºäº†æé«˜è®¡ç®—æ•ˆç‡, æˆ‘ä»¬ä¸éœ€è¦å¯¹ç¯å¢ƒä¸­æ‰€æœ‰çš„ ${s, a}$ ç»„åˆ è¿›è¡Œç©·ä¸¾, å¹¶è®¡ç®—å€¼å‡½æ•°. åªéœ€è¦å°†å½“å‰çš„æ¢ç´¢ ${\left(s, a, r, s{\prime}, a{\prime}\right)}$ ä¸­ ${s{\prime}, a{\prime}}$ ä½œä¸ºä¸‹ä¸€æ¬¡ ä¼°è®¡çš„èµ·å§‹çŠ¶æ€å’ŒåŠ¨ä½œ.

æ—¶åºå·®åˆ†å­¦ä¹ æ˜¯ #å¼ºåŒ–å­¦ä¹  çš„ä¸»è¦å­¦ä¹ æ–¹æ³•, å…¶å…³é”®æ­¥éª¤å°±æ˜¯åœ¨æ¯æ¬¡è¿­ä»£ä¸­ä¼˜åŒ–Qå‡½æ•°æ¥å‡å°‘ç°å® ${r+\gamma Q\left(s{\prime}, a{\prime}\right)}$ å’Œé¢„æœŸ ${Q(s, a)}$ çš„å·®è·. è¿™å’ŒåŠ¨ç‰©å­¦ä¹ çš„æœºåˆ¶ååˆ†ç›¸åƒï¼
åœ¨å¤§è„‘ç¥ç»å…ƒä¸­ï¼Œå¤šå·´èƒºçš„é‡Šæ”¾æœºåˆ¶å’Œæ—¶åºå·®åˆ†å­¦ä¹ ååˆ†å»åˆï¼[Schultz, 1998] çš„ä¸€ä¸ªå®éªŒä¸­ï¼Œé€šè¿‡ç›‘æµ‹çŒ´å­å¤§è„‘é‡Šæ”¾çš„å¤šå·´èƒºæµ“åº¦ï¼Œå‘ç°å¦‚æœçŒ´å­è·å¾—æ¯”é¢„æœŸæ›´å¤šçš„æœæ±ï¼Œæˆ–è€…åœ¨æ²¡æœ‰é¢„æƒ³åˆ°çš„æ—¶é—´å–åˆ°æœæ±, å¤šå·´èƒºé‡Šæ”¾å¤§å¢ï¼å¦‚æœæ²¡æœ‰å–åˆ°æœ¬æ¥é¢„æœŸçš„æœæ±ï¼Œå¤šå·´èƒºçš„é‡Šæ”¾å°±ä¼šå¤§å‡ï¼å¤šå·´èƒºçš„é‡Šæ”¾, æ¥è‡ªå¯¹äºå®é™…å¥–åŠ±å’Œé¢„æœŸå¥–åŠ±çš„å·®å¼‚ï¼Œè€Œä¸æ˜¯å¥–åŠ±æœ¬èº«ï¼

æ—¶åºå·®åˆ†å­¦ä¹ æ–¹æ³•å’Œè’™ç‰¹å¡ç½—æ–¹æ³•çš„ä¸»è¦ä¸åŒä¸ºï¼šè’™ç‰¹å¡ç½—æ–¹æ³•éœ€è¦ä¸€æ¡å®Œæ•´çš„è·¯å¾„æ‰èƒ½çŸ¥é“å…¶æ€»å›æŠ¥ï¼Œä¹Ÿä¸ä¾èµ–é©¬å°”å¯å¤«æ€§è´¨ï¼›è€Œæ—¶åºå·®åˆ†å­¦ä¹ æ–¹æ³•åªéœ€è¦ä¸€æ­¥ï¼Œå…¶æ€»å›æŠ¥éœ€è¦é€šè¿‡é©¬å°”å¯å¤«æ€§è´¨æ¥è¿›è¡Œè¿‘ä¼¼ä¼°è®¡ï¼

## Qå­¦ä¹ 
#Qå­¦ä¹  ( Q-Learning ) ç®—æ³• [Watkins et al., 1992] æ˜¯ä¸€ç§ #å¼‚ç­–ç•¥ çš„ #æ—¶åºå·®åˆ†å­¦ä¹ æ–¹æ³•. äº‹å®ä¸Šï¼ŒQå­¦ä¹ ç®—æ³•è¢«æå‡ºçš„æ—¶é—´æ›´æ—©ï¼ŒSARSAç®—æ³•æ˜¯Qå­¦ä¹ ç®—æ³•çš„æ”¹è¿›ï¼åœ¨Qå­¦ä¹ ä¸­, ${\mathrm{Q}}$ å‡½æ•°çš„ä¼°è®¡æ–¹æ³•ä¸º $${ Q(s, a) \leftarrow Q(s, a)+\alpha\left(r+\gamma \max _{a{\prime}} Q\left(s{\prime}, a{\prime}\right)-Q(s, a)\right), }$$ ç›¸å½“äºè®© ${Q(s, a)}$ ç›´æ¥å»ä¼°è®¡æœ€ä¼˜çŠ¶æ€å€¼å‡½æ•° ${Q^{*}(s, a)}$. ä¸ SARSA ç®—æ³•ä¸åŒ, Qå­¦ä¹ ç®—æ³•ä¸é€šè¿‡ ${\pi^{\epsilon}}$ æ¥é€‰ä¸‹ä¸€æ­¥çš„åŠ¨ä½œ ${a{\prime}}$, è€Œæ˜¯ç›´æ¥ é€‰æœ€ä¼˜çš„ ${\mathrm{Q}}$ å‡½æ•°, å› æ­¤æ›´æ–°åçš„ ${\mathrm{Q}}$ å‡½æ•°æ˜¯å…³äºç­–ç•¥ ${\pi}$ çš„, è€Œä¸æ˜¯ç­–ç•¥ ${\pi^{\epsilon}}$ çš„. 
Qå­¦ä¹ çš„å­¦ä¹ è¿‡ç¨‹å¦‚ä¸‹.
$$\begin{array}{ll} 
\hline 
& \text{Qå­¦ä¹ }\\
\hline 
& \text{è¾“å…¥: çŠ¶æ€ç©ºé—´ } \mathcal{S}, \text{ åŠ¨ä½œç©ºé—´ } \mathcal{A}, \text{ æŠ˜æ‰£ç‡ } \gamma, \text{ å­¦ä¹ ç‡ } \alpha \\
1& \quad  \forall s, \forall a, \text{ éšæœºåˆå§‹åŒ– } Q(s, a); \text{ Q å‡½æ•°æ„å»ºç­–ç•¥ } \pi; \\
2& \quad \text{ repeat } \\
3& \quad \quad \text{ åˆå§‹åŒ–èµ·å§‹çŠ¶æ€ } s; \\
4& \quad \quad \text{ repeat } \\
5& \quad \quad \quad \text{ åœ¨çŠ¶æ€ } s, \text{ é€‰æ‹©åŠ¨ä½œ } a=\pi^{\epsilon}(s); \\
6& \quad \quad \quad \text{ æ‰§è¡ŒåŠ¨ä½œ } a, \text{ å¾—åˆ°å³æ—¶å¥–åŠ± } r \text{ å’Œæ–°çŠ¶æ€ } s{\prime}; \\
7& \quad \quad \quad Q(s, a) \leftarrow Q(s, a)+\alpha\left(r+\gamma \max _{a{\prime}} Q\left(s{\prime}, a{\prime}\right)-Q(s, a)\right) ; \\
8& \quad \quad \quad s \leftarrow s{\prime}; \\
9& \quad \quad \text{ until } s \text{ ä¸ºç»ˆæ­¢çŠ¶æ€ } ; \\
10& \quad \text{ until } \forall s, a, Q(s, a) \text{ æ”¶æ•› }; \\
& \text{ è¾“å‡º: ç­–ç•¥ } {\pi(s)=\arg \max _{a \in|\mathcal{A}|} Q(s, a)}\\
\hline 
\end{array}
$$

